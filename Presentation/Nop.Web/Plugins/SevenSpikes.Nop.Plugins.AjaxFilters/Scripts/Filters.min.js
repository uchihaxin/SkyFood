/*
* Copyright 2015 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

var nop7SpikesAjaxFiltersGridClass = "nop7SpikesAjaxFiltersGrid"; $(document).ready(function () { var a = new FiltersManager; a.addProductPanelAjaxBusyToPage(); $(".nopAjaxFilters7Spikes .block .title a.toggleControl").off("click").on("click", function () { expandableFiltersBlocks($(this)) }); $(".nopAjaxFilters7Spikes .block .title a.clearFilterOptions").each(function () { $(this).click({ filtersManager: a }, a.clearFilterOptions); $(this).hide() }); $(".nopAjaxFilters7Spikes .filtersDropDown a.allFilterDropDownOptions").each(function () { $(this).click({ filtersManager: a }, a.selectAllFilterDropDownOption) }); var b = $(".nopAjaxFilters7Spikes .filtersTitlePanel a.clearFilterOptionsAll"); b.click({ filtersManager: a }, a.clearAllFilterOptions); b.hide(); a.replaceSortAndViewOptionsDropDowns(); a.refreshProductsPager(); if (a.filtersUIMode == a.filtersUIModeEnum.useDropDowns) { var b = $(".filtersDropDownPanel.filtersGroupPanel"), c = b.length + 100; b.each(function () { $(this).css("z-index", c--) }) } "true" == $(".nopAjaxFilters7Spikes").attr("data-enableinfinitescroll").toLowerCase() && initializeInfiniteScroll() }); function FiltersManager() { this.isOnSearchPage = $(".nopAjaxFilters7Spikes").attr("data-isonsearchpage"); this.keyword = $(".nopAjaxFilters7Spikes").attr("data-searchkeyword"); this.searchCategoryId = $(".nopAjaxFilters7Spikes").attr("data-searchcategoryid"); this.searchManufacturerId = $(".nopAjaxFilters7Spikes").attr("data-searchmanufacturerid"); this.priceFrom = $(".nopAjaxFilters7Spikes").attr("data-searchpricefrom"); this.priceTo = $(".nopAjaxFilters7Spikes").attr("data-searchpriceto"); this.includeSubcategories = $(".nopAjaxFilters7Spikes").attr("data-searchincludesubcategories"); this.searchInProductDescriptions = $(".nopAjaxFilters7Spikes").attr("data-searchinproductdescriptions"); this.advancedSearch = $(".nopAjaxFilters7Spikes").attr("data-searchadvancedsearch"); this.categoryId = $(".nopAjaxFilters7Spikes").attr("data-categoryId"); this.manufacturerId = $(".nopAjaxFilters7Spikes").attr("data-manufacturerId"); this.vendorId = $(".nopAjaxFilters7Spikes").attr("data-vendorId"); this.getFilteredProductsUrl = $(".nopAjaxFilters7Spikes").attr("data-getFilteredProductsUrl"); this.filtersUIMode = $(".nopAjaxFilters7Spikes").attr("data-filtersUIMode"); this.filtersUIModeEnum = { userCheckboxes: "usecheckboxes", useDropDowns: "usedropdowns" }; this.selectedFilterOptionElement = this.selectedFilterGroupElement = void 0; this.isProductRefreshTriggeredByScroll = !1; this.requestProductsForSelectedFilters = RequestProductsForSelectedFilters; this.getSpecificationFiltersModel = GetSpecificationFiltersModel; this.getAttributeFiltersModel = GetAttributeFiltersModel; this.getManufacturerFiltersModel = GetManufacturerFiltersModel; this.getVendorFiltersModel = GetVendorFiltersModel; this.getOnSaleFiltersModel = GetOnSaleFiltersModel; this.getPriceRangeFilterModel = GetPriceRangeFilterModel; this.refreshProducts = RefreshProducts; this.refreshProductsPager = RefreshProductsPager; this.replaceSortAndViewOptionsDropDowns = ReplaceSortAndViewOptionsDropDowns; this.setPagerLinks = SetPagerLinks; this.getProductsPanelSelector = GetProductsPanelSelector; this.getPagerPanelSelector = GetPagerPanelSelector; this.getSortOptionsDropDownSelector = GetSortOptionsDropDownSelector; this.getViewOptionsDropDownSelector = GetViewOptionsDropDownSelector; this.getProductsPageSizeDropDownSelector = GetProductsPageSizeDropDownSelector; this.sortProducts = SortProducts; this.changeViewMode = ChangeViewMode; this.changePageSize = ChangePageSize; this.clearFilterOptions = ClearFilterOptions; this.clearFilterOptionsForFiltersGroupElement = ClearFilterOptionsForFiltersGroupElement; this.selectAllFilterDropDownOption = SelectAllFilterDropDownOption; this.clearAllFilterOptions = ClearAllFilterOptions; this.refreshClearButtons = RefreshClearButtons; this.expandFilterPanelsWithSelectedOptions = ExpandFilterPanelsWithSelectedOptions; this.changeViewModeOrderByAndPageSize = ChangeViewModeOrderByAndPageSize; this.setPriceRangeValues = SetPriceRangeValues; this.refreshFilters = RefreshFilters; this.addProductPanelAjaxBusyToPage = function () { var a = getProductsPanel(); a.addClass("ajaxBusyPanelParent " + nop7SpikesAjaxFiltersGridClass); a.css("position", "relative"); a.append($('<div class="productPanelAjaxBusy"></div><div class="clear"></div>')); $(".productPanelAjaxBusy").hide(); appendInfiniteScrollLoader() }; this.setSpecificationFilterSelection = function (a, b) { this.selectedFilterGroupElement = a; this.selectedFilterOptionElement = b }; this.determineIfRequestIsValidForControlState = function (a) { var b = !1; if (void 0 == a || "filterItemUnselected" == a.attr("class") || "filterItemSelected" == a.attr("class") && this.filtersUIMode == this.filtersUIModeEnum.userCheckboxes) b = !0; return b }; this.changeControlsState = function (a) { if (void 0 != a) { var b = a.attr("class"); "filterItemSelected" == b ? a.attr("class", "filterItemUnselected") : "filterItemUnselected" == b && a.attr("class", "filterItemSelected"); if (void 0 != this.selectedFilterGroupElement && this.filtersUIMode == this.filtersUIModeEnum.useDropDowns) { var c = this.selectedFilterOptionElement; this.selectedFilterGroupElement.find("a[data-option-id],[data-option-ids]").each(function (a, b) { "filterItemSelected" == $(b).attr("class") && b != c.get(0) && $(b).attr("class", "filterItemUnselected") }) } } }; this.showNoProductsModalDialog = function () { var a = $("#nopAjaxFiltersNoProductsDialog").data("kendoWindow"), b = $("#nopAjaxFiltersNoProductsDialog").attr("title"); b || (b = "NO RESULTS FOUND"); a || (a = $("#nopAjaxFiltersNoProductsDialog").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", title: b, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), a.wrapper.addClass("ajaxFilters")); a.center(); a.open() }; this.showProductPanelAjaxBusy = function () { $(".productPanelAjaxBusy").show() }; this.hideProductPanelAjaxBusy = function () { $(".productPanelAjaxBusy").hide() } } FiltersManager.prototype.getFilterItemStateBasedOnItemClass = function (a, b) { var c = b; switch (a) { case "filterItemUnselected": c = "Unchecked"; break; case "filterItemSelected": c = "Checked"; break; case "filterItemSelectedDisabled": c = "CheckedDisabled"; break; case "filterItemDisabled": c = "Disabled" } return c }; FiltersManager.prototype.getFilterItemClassBasedOnState = function (a, b) { var c = b; switch (a) { case 0: c = "filterItemUnselected"; break; case 1: c = "filterItemSelected"; break; case 2: c = "filterItemSelectedDisabled"; break; case 3: c = "filterItemDisabled" } return c }; FiltersManager.waitForAjaxRequest = !1; function RequestProductsForSelectedFilters(a, b, c, d, e, f, g) { if (!FiltersManager.waitForAjaxRequest && "#/noFilterApplied" != d && this.determineIfRequestIsValidForControlState(b)) { this.isProductRefreshTriggeredByScroll = g || !1; void 0 == d ? d = "" : f = !0; this.setSpecificationFilterSelection(a, b); this.changeControlsState(b); a = this.getSpecificationFiltersModel(); b = this.getAttributeFiltersModel(); g = this.getManufacturerFiltersModel(); var k = this.getVendorFiltersModel(), m = this.getOnSaleFiltersModel(), p = this.getPriceRangeFilterModel(); void 0 == c && (c = null); var n = $(".sortOptionsDropDown").attr("data-DropDownOptionsSelectedValue") || $(".nopAjaxFilters7Spikes").attr("data-defaultsortoption") || null, l = this.getViewOptionsDropDownSelector(), l = $(l).filter(".selected"), q = !1; 0 < l.length && (q = !0, $(".viewOptionsDropDown").attr("data-DropDownOptionsSelectedValue", l.attr("data-dropdownoptionvalue"))); var l = $(".viewOptionsDropDown").attr("data-DropDownOptionsSelectedValue") || null, r = $(".productsPageSizeDropDown").attr("data-DropDownOptionsSelectedValue") || null, t = $.getUrlVar("pagenumber"); void 0 == t || null != c || void 0 != e && 0 != e || (c = t); void 0 == f && (f = !1); c = { categoryId: this.categoryId, manufacturerId: this.manufacturerId, vendorId: this.vendorId, priceRangeFilterModel7Spikes: p, specificationFiltersModel7Spikes: a, attributeFiltersModel7Spikes: b, manufacturerFiltersModel7Spikes: g, vendorFiltersModel7Spikes: k, pageNumber: c, orderby: n, viewmode: l, pagesize: r, queryString: d, shouldNotStartFromFirstPage: f, onSaleFilterModel: m, keyword: this.keyword, searchCategoryId: this.searchCategoryId, searchManufacturerId: this.searchManufacturerId, priceFrom: this.priceFrom, priceTo: this.priceTo, includeSubcategories: this.includeSubcategories, searchInProductDescriptions: this.searchInProductDescriptions, advancedSearch: this.advancedSearch, isOnSearchPage: this.isOnSearchPage }; this.isProductRefreshTriggeredByScroll || this.showProductPanelAjaxBusy(); var h = this; e = this.getFilteredProductsUrl; FiltersManager.waitForAjaxRequest = !0; $.ajax({ cache: !1, type: "POST", data: $.toJSON(c), contentType: "application/json; charset=utf-8", url: e }).done(function (a) { "" != d && (h.changeViewModeOrderByAndPageSize(a, q), h.setPriceRangeValues(a)); if (h.refreshProducts(a, h.isProductRefreshTriggeredByScroll)) { h.refreshFilters(a); h.refreshProductsPager(a); h.refreshClearButtons(); if ("NO HASH QUERY" != d) { h.expandFilterPanelsWithSelectedOptions(); var b = $(a).filter("#urlHashQuery").val().toString(); "" != b ? (h.isProductRefreshTriggeredByScroll && (b = b.slice(0, b.indexOf("&pageNumber"))), $.address.value(b)) : $.address.value("noFilterApplied") } h.hideProductPanelAjaxBusy(); FiltersManager.waitForAjaxRequest = !1; b = $(".nopAjaxFilters7Spikes").attr("data-scrollToElement"); if (!h.isProductRefreshTriggeredByScroll && void 0 != b && "true" == b.toLowerCase()) { var b = $(".nopAjaxFilters7Spikes").attr("data-scrollToElementSelector").split(","), c = ".product-selectors"; if (void 0 != b && 0 < b.length) { for (var e = 0; e < b.length; e++) if (0 < $(b[e].trim()).length) { c = b[e].trim(); break } 0 < $(c).length && $("html, body").animate({ scrollTop: $(c).offset().top }, "slow") } } 1 > $(".productPanelAjaxBusy").length && h.addProductPanelAjaxBusyToPage(); a = $(a).filter("#totalCount").val().toString(); $.event.trigger({ type: "nopAjaxFiltersFiltrationCompleteEvent", totalCount: a }); "true" == $(".nopAjaxFilters7Spikes").attr("data-showSelectedFiltersPanel").toLowerCase() && showSelectedOptions() } else h.changeControlsState(h.selectedFilterOptionElement), FiltersManager.waitForAjaxRequest = !1 }).fail(function () { h.hideProductPanelAjaxBusy(); alert("Loading the page failed."); FiltersManager.waitForAjaxRequest = !1 }).always(function () { h.isProductRefreshTriggeredByScroll = !1 }) } } function RefreshFilters(a) { var b = $(a).filter("#specificationFilterModel7SpikesJson").val().toString(), b = $.parseJSON(b); void 0 != this.refreshSpecificationFilters && this.refreshSpecificationFilters(b, this.filtersUIMode); b = $(a).filter("#attributeFilterModel7SpikesJson").val().toString(); b = $.parseJSON(b); void 0 != this.refreshAttributeFilters && this.refreshAttributeFilters(b, this.filtersUIMode); b = $(a).filter("#manufacturerFilterModel7SpikesJson").val().toString(); b = $.parseJSON(b); void 0 != this.refreshManufacturerFilters && this.refreshManufacturerFilters(b, this.filtersUIMode); b = $(a).filter("#vendorFilterModel7SpikesJson").val().toString(); b = $.parseJSON(b); void 0 != this.refreshVendorFilters && this.refreshVendorFilters(b, this.filtersUIMode); a = $(a).filter("#onSaleFilterModel7SpikesJson").val().toString(); a = $.parseJSON(a); void 0 != this.refreshOnSaleFilters && this.refreshOnSaleFilters(a, this.filtersUIMode) } function SetPriceRangeValues(a) { var b = $(a).filter("#priceRangeFromJson").val().toString(), b = $.parseJSON(b); a = $(a).filter("#priceRangeToJson").val().toString(); a = $.parseJSON(a); void 0 != this.SetSliderValues && this.SetSliderValues(b, a) } function RequestProductsForPagerLink(a) { var b = $(a.currentTarget).attr("data-pageNumber"); null != a.data && void 0 != a.data.filtersManager && a.data.filtersManager.requestProductsForSelectedFilters(void 0, void 0, b, void 0, void 0, !0) } function GetSpecificationFiltersModel() { var a = null; void 0 != this.buildSpecificationFiltersModel && (a = this.buildSpecificationFiltersModel(this.categoryId, this.manufacturerId, this.vendorId, this.selectedFilterGroupElement)); return a } function GetAttributeFiltersModel() { var a = null; void 0 != this.buildAttributeFiltersModel && (a = this.buildAttributeFiltersModel(this.categoryId, this.manufacturerId, this.vendorId, this.selectedFilterGroupElement)); return a } function GetManufacturerFiltersModel() { var a = null; void 0 != this.buildManufacturerFiltersModel && (a = this.buildManufacturerFiltersModel(this.categoryId, this.selectedFilterGroupElement)); return a } function GetVendorFiltersModel() { var a = null; void 0 != this.buildVendorFiltersModel && (a = this.buildVendorFiltersModel(this.categoryId, this.selectedFilterGroupElement)); return a } function GetOnSaleFiltersModel() { var a = null; void 0 != this.buildOnSaleFiltersModel && (a = this.buildOnSaleFiltersModel(this.categoryId, this.manufacturerId, this.vendorId, this.selectedFilterGroupElement)); return a } function GetPriceRangeFilterModel() { var a = null; void 0 != this.buildPriceRangeFilterModel && (a = this.buildPriceRangeFilterModel(this.categoryId, this.manufacturerId, this.vendorId, this.selectedFilterGroupElement)); return a } function RefreshProducts(a, b) { var c = $(".viewOptionsDropDown").attr("data-DropDownOptionsSelectedValue") || $(".nopAjaxFilters7Spikes").attr("data-defaultViewMode"), d = this.getProductsPanelSelector(c), c = $("." + nop7SpikesAjaxFiltersGridClass); if (null != $(a).filter(d).html()) { 1 < c.length && (c = c.last()); if (b) { var d = $(a).filter(d), e = d.find(".item-box"); d.hasClass("product-grid") ? c.hasClass("product-list") && c.removeClass("product-list").addClass("product-grid") : c.hasClass("product-grid") && c.removeClass("product-grid").addClass("product-list"); $(".infinite-scroll-loader").hide(); c.find(".item-box").last().after(e) } else c.replaceWith($(a).filter(d)); c = !0 } else this.hideProductPanelAjaxBusy(), 0 < $("#nopAjaxFiltersNoProductsDialog").length || c.prepend($(a).filter("#nopAjaxFiltersNoProductsDialog")), this.showNoProductsModalDialog(), c = !1; return c } function GetProductsPanelSelector(a) { return "list" == a ? $(".nopAjaxFilters7Spikes").attr("data-ProductsListPanelSelector") || ".product-list" : $(".nopAjaxFilters7Spikes").attr("data-productsGridPanelSelector") || ".product-grid" } function GetPagerPanelSelector() { return $(".nopAjaxFilters7Spikes").attr("data-pagerPanelSelector") || ".pager" } function RefreshProductsPager(a) { var b = this.getPagerPanelSelector(), c = $(b); c.html($(a).filter(b).html()); this.setPagerLinks(c) } function SetPagerLinks(a) { var b = this; a.find("a").each(function () { var a = $(this).attr("href"), d = ""; void 0 != a && (a = a.toLowerCase(), a = /pagenumber=(\d+)/.exec(a), null != a && 1 < a.length && (d = a[1])); $(this).removeAttr("href"); $(this).attr("data-pageNumber", d); $(this).click({ filtersManager: b }, RequestProductsForPagerLink) }) } function getIdOrClassSelector(a) { if (0 < $(a).length) return a; var b = a.slice(1); return a.startsWith("#") ? "." + b : a.startsWith(".") ? "#" + b : a } function GetSortOptionsDropDownSelector() { var a = $(".nopAjaxFilters7Spikes").attr("data-sortOptionsDropDownSelector") || ".products-orderby"; return getIdOrClassSelector(a) } function GetViewOptionsDropDownSelector() { var a = $(".nopAjaxFilters7Spikes").attr("data-viewOptionsDropDownSelector") || ".products-viewmode, .viewmode-icon"; return getIdOrClassSelector(a) } function GetProductsPageSizeDropDownSelector() { var a = $(".nopAjaxFilters7Spikes").attr("data-productsPageSizeDropDownSelector") || ".products-pagesize"; return getIdOrClassSelector(a) } function ChangeViewModeOrderByAndPageSize(a, b) { var c = $(a).filter("#currentPageSizeJson").val().toString(), c = $.parseJSON(c), d = $(a).filter("#currentOrderByJson").val().toString(), d = $.parseJSON(d), e = $(a).filter("#currentViewModeJson").val().toString(), e = $.parseJSON(e), f = $(".sortOptionsDropDown"), g = $(".viewOptionsDropDown"), k = $(".productsPageSizeDropDown"); null == b && (b = !1); b && (g = $(this.getViewOptionsDropDownSelector())); if (0 != f.length || 0 != g.length || 0 != k.length) { var m = [], p = [], n = [], l = PopulateOptions(f, m, "#availableSortOptionsJson", d), q = PopulateOptions(g, p, "#availableViewModesJson", e), r = PopulateOptions(k, n, "#availablePageSizesJson", c); void 0 != c && SetSelectedElementByDropdownSelector(k, r, n); void 0 != d && SetSelectedElementByDropdownSelector(f, l, m); void 0 != e && SetSelectedElementByDropdownSelector(g, q, p, b) } } function SetSelectedElementByDropdownSelector(a, b, c, d) { var e = a.find("li").eq(b); if (!0 === d) { e = a.eq(b); a.removeClass("selected"); var f = ".grid"; a.eq(b).hasClass("list") && (f = ".list"); a.filter(f).addClass("selected") } 0 < e.length && void 0 != a && (a.each(function () { this.selectedLiElement = e; void 0 !== this.par && this.par.text(e.text()) }), !0 === d && (a = $(".viewOptionsDropDown")), a.attr("data-dropDownOptionsSelectedValue", c[b].dropDownOptionValue)) } function ReplaceSortAndViewOptionsDropDowns() { var a = this.getSortOptionsDropDownSelector(), b = $(a), a = this.getViewOptionsDropDownSelector(), c = $(a), a = this.getProductsPageSizeDropDownSelector(), d = $(a), e = c.is("select"); if (0 != b.length || 0 != c.length || 0 != d.length) { var f = [], g = [], k = [], m = PopulateOptions(b, f, "#availableSortOptionsJson"), p = PopulateOptions(c, g, "#availableViewModesJson"), n = PopulateOptions(d, k, "#availablePageSizesJson"), l = nop_store_directory_root + "Plugins/SevenSpikes.Nop.Plugins.AjaxFilters/JQueryTemplates/JDropDown.htm", q = this; $.ajax({ url: l, async: !1, success: function (a) { $.template("jDropDownTemplate", a); b.each(function (a) { $.tmpl("jDropDownTemplate", { jDropDownId: "sortOptionsDropDown" + a, jDropDownCss: "sortOptionsDropDown", dropDownOptions: f }, { selectedOptionIndex: m, dropDownOptionClickCallback: "new FiltersManager().sortProducts" }).insertAfter($(this)); $(this).attr("data-dropDownOptionsSelectedValue", f[m].dropDownOptionValue) }); b.remove(); 0 < c.length && (e ? (c.each(function (a) { $.tmpl("jDropDownTemplate", { jDropDownId: "viewOptionsDropDown" + a, jDropDownCss: "viewOptionsDropDown", dropDownOptions: g }, { selectedOptionIndex: p, dropDownOptionClickCallback: "new FiltersManager().changeViewMode" }).insertAfter($(this)); $(".viewOptionsDropDown").attr("data-dropDownOptionsSelectedValue", g[selectedOptionIndex].dropDownOptionValue) }), c.remove()) : (c.filter(".grid").attr("data-dropdownoptionvalue", "grid"), c.filter(".list").attr("data-dropdownoptionvalue", "list"), c.parent().append('<input type="hidden" class="viewOptionsDropDown" value="icons" data-DropDownOptionsSelectedValue="' + c.filter(".selected").attr("data-dropdownoptionvalue") + '" />'), c.on("click", function (a) { a.preventDefault(); $(this).hasClass("selected") || (c.removeClass("selected"), $(this).addClass("selected"), q.changeViewMode(a)) }))); d.each(function (a) { $.tmpl("jDropDownTemplate", { jDropDownId: "productsPageSizeDropDown" + a, jDropDownCss: "productsPageSizeDropDown", dropDownOptions: k }, { selectedOptionIndex: n, dropDownOptionClickCallback: "new FiltersManager().changePageSize" }).insertAfter($(this)); $(this).attr("data-dropDownOptionsSelectedValue", k[n].dropDownOptionValue) }); d.remove() }, error: function (a, b, c) { alert("Retrieving " + l + " failed.") } }) } } function PopulateOptions(a, b, c, d) { var e = 0; 0 < a.length && (a = $(c).val().toString(), a = $.parseJSON(a), $.each(a, function (a, c) { b.push({ dropDownOptionName: c.Text, dropDownOptionValue: c.Value }); d ? c.Value == d && (e = a) : 0 == e && c.Selected && (e = a) })); return e } function SortProducts(a) { changeDropDownSelectedOption(".sortOptionsDropDown", a.currentTarget); (new FiltersManager).requestProductsForSelectedFilters() } function ChangeViewMode(a) { var b = $(a.currentTarget).attr("data-DropDownOptionValue"); changeDropDownSelectedOption(".viewOptionsDropDown", a.currentTarget); a = new FiltersManager; var c = $(a.getViewOptionsDropDownSelector()); c.is("select") || c.removeClass("selected").filter("." + b).addClass("selected"); a.requestProductsForSelectedFilters(void 0, void 0, void 0, void 0, void 0, !0) } function ChangePageSize(a) { changeDropDownSelectedOption(".productsPageSizeDropDown", a.currentTarget); (new FiltersManager).requestProductsForSelectedFilters() } function changeDropDownSelectedOption(a, b) { var c = $(b).attr("data-DropDownOptionValue"); $(a).each(function () { var a = $(this).find('[data-dropdownoptionvalue="' + c + '"]').parent("li"); this.selectedLiElement = a; void 0 !== this.par && this.par.text(a.text()) }).attr("data-DropDownOptionsSelectedValue", c) } function SelectAllFilterDropDownOption(a) { var b = $(a.currentTarget).parents(".filtersGroupPanel"); a.data.filtersManager.clearFilterOptionsForFiltersGroupElement(b) } function ClearFilterOptions(a) { var b = $(a.currentTarget).parent().siblings(".filtersGroupPanel"); a.data.filtersManager.clearFilterOptionsForFiltersGroupElement(b) } function ClearFilterOptionsForFiltersGroupElement(a) { $(a).find("a[data-option-id], a[data-optionsGroupId]").each(function (a, c) { "filterItemSelected" == $(c).attr("class") ? $(c).attr("class", "filterItemUnselected") : "filterItemSelectedDisabled" == $(c).attr("class") && $(c).attr("class", "filterItemDisabled") }); this.filtersUIMode == this.filtersUIModeEnum.useDropDowns && $(a).find(".filtersDropDown").jDropDown({ method: "reset" }); this.requestProductsForSelectedFilters(a, void 0) } function ClearAllFilterOptions(a) { $(".nopAjaxFilters7Spikes .filtersGroupPanel").each(function (a, c) { $(c).find("a[data-option-id], a[data-optionsGroupId]").each(function (a, b) { $(b).attr("class", "filterItemUnselected") }) }); a = a.data.filtersManager; a.filtersUIMode == a.filtersUIModeEnum.useDropDowns && $(".nopAjaxFilters7Spikes .filtersGroupPanel .filtersDropDown").jDropDown({ method: "reset" }); void 0 != a.clearPriceRangeFilterControl && a.clearPriceRangeFilterControl(); a.requestProductsForSelectedFilters() } function RefreshClearButtons() { var a = !1; $(".nopAjaxFilters7Spikes .filtersGroupPanel").each(function (b, c) { var f = !1; $(c).find("a[data-option-id], a[data-optionsGroupId]").each(function (a, b) { if ("filterItemSelected" == $(b).attr("class")) return f = !0, !1 }); var g = $(c).parent().find("a.clearFilterOptions"); f ? (g.show(), a = !0) : g.hide() }); var b = $(".nopAjaxFilters7Spikes .filtersTitlePanel a.clearFilterOptionsAll"); if (a) b.show(); else { var c = !1; void 0 != this.determineIfPriceRangeHasBeenSelected && (c = this.determineIfPriceRangeHasBeenSelected()); c ? b.show() : b.hide() } } function ExpandFilterPanelsWithSelectedOptions() { $(".clearPriceRangeFilter, .clearFilterOptions").filter(":visible").siblings("a.toggleControl.closed").click() } function expandableFiltersBlocks(a) { 1 == a.hasClass("closed") ? a.removeClass("closed") : a.addClass("closed"); a.parent().siblings(".filtersGroupPanel").slideToggle("slow", function () { $(this).css("overflow", "") }) } function showSelectedOptions() { var a = $(".nopAjaxFilters7Spikes"), b = $(".block.filter-block.selected-options"), c = b.find(".selected-options-list"); c.empty(); b.find("a.toggleControl").off("click").on("click", function () { expandableFiltersBlocks($(this)) }); var d = a.find(".priceRangeFilterPanel7Spikes"); if (0 < d.length) { var e = d.find("#slider"), f = e.attr("data-sliderminvalue"), g = e.attr("data-slidermaxvalue"), k = $(".priceRangeCurrentPricesPanel .currentMinPrice").text(), m = $(".priceRangeCurrentPricesPanel .currentMaxPrice").text(); 0 < e.length && (f != k || g != m) && (e = $('<span class="option">' + k + " - " + m + "</span>"), e.anchorCustomClick(d.find(".clearPriceRangeFilter")), d = d.find(".toggleControl").text(), d = $('<li class="price-range-selected-ranges"><label>' + d + ":</label></li>"), d.append(e), c.append(d)) } a.find(".filter-block").has(".filterItemSelected").each(function (b, d) { var e = $("<li><label>" + $(d).children(".title").children("a.toggleControl").first().text() + ":</label></li>"); $(d).find(".filterItemSelected").each(function () { var b = $('<span class="option">' + $(this).text() + "</span>"); "usedropdowns" == a.attr("data-filtersuimode") ? b.anchorCustomClick($(this).parents(".filtersGroupPanel").siblings(".title").children(".clearFilterOptions")) : b.anchorCustomClick($(this)); e.append(b) }); c.append(e) }); 0 < c.children().length ? b.show() : b.hide() } function getProductsPanel() { var a = $(".nopAjaxFilters7Spikes").attr("data-productsGridPanelSelector") + "," + $(".nopAjaxFilters7Spikes").attr("data-ProductsListPanelSelector"); return $(".master-wrapper-page " + a).not(".featured-product-grid").last() } function initializeInfiniteScroll() { appendInfiniteScrollLoader(); $(".product-page-size, " + $(".nopAjaxFilters7Spikes").attr("data-pagerpanelselector")).hide(); var a = function () { $(window).off("scroll.filtersinfinitescroll resize.filtersinfinitescroll orientationchange.filtersinfinitescroll").on("scroll.filtersinfinitescroll resize.filtersinfinitescroll orientationchange.filtersinfinitescroll", function () { executeInfiniteScroll() }); executeInfiniteScroll() }; $(document).on("nopAjaxFiltersFiltrationCompleteEvent", a); window.location.hash && "#/noFilterApplied" != window.location.hash || a() } function executeInfiniteScroll() { var a = $(".pager .next-page > a").first(); if (0 == a.length) $(window).off("scroll.filtersinfinitescroll resize.filtersinfinitescroll orientationchange.filtersinfinitescroll"); else { var b = getProductsPanel(); if (0 != b.length) { var c = $(window).outerHeight(), d = $(window).scrollTop(), e = b.innerHeight(), b = b.offset().top; c + d > e + b && ($(".infinite-scroll-loader").show(), c = new FiltersManager, a = parseInt(a.attr("data-pageNumber")), c.requestProductsForSelectedFilters(void 0, void 0, a, void 0, void 0, !0, !0)) } } } function appendInfiniteScrollLoader() { if (0 == $(".infinite-scroll-loader").length) { var a = $(".ajaxBusyPanelParent"); 0 == a.length && (a = getProductsPanel()); a.append('<div class="infinite-scroll-loader">' + $(".nopAjaxFilters7Spikes").attr("data-infinitescrollloadertext") + "</div>") } } (function (a) { a.fn.extend({ anchorCustomClick: function (b) { return a(this).first().on("click", function (c) { c.preventDefault(); a(b).trigger("click") }) } }) })(jQuery);

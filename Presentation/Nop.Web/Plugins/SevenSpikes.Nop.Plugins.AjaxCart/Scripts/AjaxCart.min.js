/*
* Copyright 2015 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/
function ajaxCartAllowedQuantitiesHover(t) { $(".productQuantityDropdown").off("mousedown").on("mousedown", function () { var a = $(this).parents(t); a.addClass("ajax-cart-product-item-hover"); var r = a.attr("data-productid"); $(".productQuantityChanged" + r).val("yes") }), $(t).off("mouseenter").on("mouseenter", function () { var t = $(this).attr("data-productid"), a = $(".productQuantityChanged" + t); "yes" == a.val() && a.val("no") }).off("mouseleave").on("mouseleave", function () { var t = $(this).attr("data-productid"), a = $(".productQuantityChanged" + t); "no" == a.val() && $(this).removeClass("ajax-cart-product-item-hover") }) } $(document).ready(function () { !function (t, a, r) { function o() { var t = c(), r = t.buttonsParameters; if (r.length > 0) { var o = H(); a.ajax({ cache: !1, type: "POST", data: a.toJSON(r), contentType: "application/json; charset=utf-8", url: o, success: function (a) { if ("" != a) for (var r = 0; r < t.addToCartButtons.length; r++) q(a, t.addToCartButtons[r]) }, error: function () { } }) } } function e(r) { if (!t.waitForAjaxRequest) { t.waitForAjaxRequest = !0; var o = I(), e = a.getAttrValFromDom(r.currentTarget, "data-productId"), i = k(r.currentTarget), d = { productId: e, quantity: i }; R(), a.ajax({ cache: !1, type: "POST", dataType: "json", data: a.toJSON(d), contentType: "application/json; charset=utf-8", url: o, success: function (t) { n(t, r, !1) }, error: function () { n(data, r, !0) } }) } } function n(r, o, e) { var n = E(), i = a.getAttrValFromDom(o.currentTarget, "data-productId"), d = k(o.currentTarget), u = { productId: i, quantity: d }; return e ? (O(), void (t.waitForAjaxRequest = !1)) : r.HasProductAttributes ? (b(i, d), O(), void (t.waitForAjaxRequest = !1)) : void a.ajax({ cache: !1, type: "POST", dataType: "json", data: a.toJSON(u), contentType: "application/json; charset=utf-8", url: n, success: function (r) { O(), t.waitForAjaxRequest = !1, "success" == r.Status ? (F(), y(), D(), V(d), T(r.ProductAddedToCartWindow), a.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" })) : "warning" == r.Status ? j(r.AddToCartWarnings) : "error" == r.Status && j(r.ErrorMessage) }, error: function () { O(), t.waitForAjaxRequest = !1 } }) } function i(o, e) { if (e == r && (e = !1), !t.waitForAjaxRequest) { t.waitForAjaxRequest = !0; var n = a(o.currentTarget), i = x(), d = a.getAttrValFromDom(o.currentTarget, "data-productId"), u = "productId", c = C(n), s = a(n).closest("form").serialize(); if (0 == s.length) { var l = Q(); formSelector = a(l).find("form"), s = a(formSelector).serialize() } 0 != s.length && (s += "&"), s += u + "=" + d, P(e), a.ajax({ cache: !1, type: "POST", data: s, url: i, success: function (r) { if ("warning" == r.Status || "error" == r.Status) { g(e), t.waitForAjaxRequest = !1; var n = a(o.currentTarget).parent().parent(); h(r.AddToCartWarnings, r.PopupTitle, e, n) } else F(), D(), V(c), y(), e && v(), g(e), t.waitForAjaxRequest = !1, T(r.ProductAddedToCartWindow), a.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" }) }, error: function () { g(e), t.waitForAjaxRequest = !1 } }) } } function d() { var t = Q(), r = a(t); 0 == r.find(".nopAjaxCartPanelAjaxBusy").length && (r.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div>'), a(".nopAjaxCartPanelAjaxBusy").hide()) } function u() { var t = Q(), r = a(t); if (r.length > 0) { r.prepend('<div class="productAddedToCartWindow"></div>'), r.prepend('<div class="miniProductDetailsView"></div>'), r.prepend('<div class="addProductVariantToCartErrors"></div>'), r.prepend('<div class="addProductToCartErrors"></div>'); var o = a(".miniProductDetailsView").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"); o.wrapper.addClass("ajaxCart") } var e = a(".productAddedToCartWindow").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"); e.wrapper.addClass("ajaxCart") } function c() { var t = m(), r = f(), o = [], e = []; return a(t).each(function () { if (!a(this).is(".nopAjaxCartProductVariantAddToCartButton")) { var t = a.getAttrValFromDom(this, "data-productid", 0); if (t && t > 0) { var r = { productId: t, isProductPage: !0, buttonElement: a(this) }, n = { productId: t, isProductPage: !0, buttonValue: p(a(this)) }; o.push(r), e.push(n) } } }), a(r).each(function () { if (!a(this).is(".nopAjaxCartProductListAddToCartButton")) { var t = s(a(this)); if (t && t > 0) { var r = { productId: t, isProductPage: !1, buttonElement: a(this) }, n = { productId: t, isProductPage: !1, buttonValue: p(a(this)) }; o.push(r), e.push(n) } } }), { addToCartButtons: o, buttonsParameters: e } } function s(t) { var o = l(); return o == r || "" == o ? 0 : a.getAttrValFromDom(a(t).parents(o), "data-productid", 0) } function l() { return a.getAttrValFromDom(U, "data-productBoxProductItemElementSelector") } function p(t) { return a.getAttrValFromDom(t, "value") } function f() { return a.getAttrValFromDom(U, "data-productBoxAddToCartButtonSelector") } function m() { return a.getAttrValFromDom(U, "data-productPageAddToCartButtonSelector") } function v() { var t = a(".miniProductDetailsView").data("kendoWindow"); t.close() } function h(t, r, o, e) { if (o) e.length > 0 ? e.find(".message-error").html(t) : a(".miniProductDetailsView .message-error").html(t); else { var n = a(".addProductVariantToCartErrors").data("kendoWindow"); n || (n = a(".addProductVariantToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", modal: !0, actions: ["Close"], animation: !1, visible: !1, title: r }).data("kendoWindow"), n.wrapper.addClass("ajaxCart")), n.content(t), n.center(), n.open() } } function g(t) { t ? A() : O() } function A() { a(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").hide() } function P(t) { t ? w() : R() } function w() { if (a(".miniProductDetailsView").length > 0) { var t = a(".miniProductDetailsView").parent().height(), r = a(".miniProductDetailsView").parent().width(); a(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").height(t - 10), a(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").width(r - 10), a(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").show() } } function C(t) { var r = 1, o = a.getAttrValFromDom(t, "data-productId"); if ("" != o) { var e = "#addtocart_" + o + "_EnteredQuantity"; if (a(e).length > 0) { var n = a(e).val(); n > 0 && (r = n) } } return r } function x() { var t = a.getHiddenValFromDom("#addProductVariantToCartUrl"); return t } function j(t) { var r = a(".addProductToCartErrors").data("kendoWindow"); r || (r = a(".addProductToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), r.wrapper.addClass("ajaxCart")), r.content(t), r.center(), r.open() } function T(t) { a(".productAddedToCartWindow").html(a(t).html()); var r = a(".productAddedToCartWindow").data("kendoWindow"); r.center(), r.open() } function V(t) { var r = '.header-links a[href="/cart"]', o = a.getHiddenValFromDom("#shoppingCartMenuLinkSelector"); a("#shoppingCartMenuLinkSelector").length > 0 && "" != o && (r = o, r = a("<div/>").html(r).text()); var e = a(r).filter(":last"); if (e.length > 0) { var n = /\d+/, i = e.html(), d = n.exec(i), u = parseInt(d); t = u + parseInt(t); var c = "(" + t + ")"; e.html(c) } } function D() { var t = a.getHiddenValFromDom("#shoppingCartBoxUrl"), r = a.getHiddenValFromDom("#shoppingCartBoxPanelSelector"); a(r).length > 0 && a.ajax({ cache: !1, type: "GET", url: t, success: function (t) { var o = a(t).filter(r); a(r).replaceWith(o) }, error: function () { } }) } function y() { var t = a.getHiddenValFromDom("#flyoutShoppingCartUrl"), r = a.getHiddenValFromDom("#flyoutShoppingCartPanelSelector"); a(r).length > 0 && a.ajax({ cache: !1, type: "GET", url: t, success: function (t) { var o = a(t).filter(r); a(r).replaceWith(o) }, error: function () { } }) } function F() { var t = a.getHiddenValFromDom("#miniShoppingCartUrl"), r = ".block.block-shoppingcart"; a(r).length > 0 && a.ajax({ cache: !1, type: "GET", url: t, success: function (t) { var o = a(t).filter(r); a(r).replaceWith(o) }, error: function () { } }) } function b(t, r) { var o = { productId: t }, e = W(); a.ajax({ cache: !1, async: !1, type: "POST", data: a.toJSON(o), contentType: "application/json; charset=utf-8", url: e, success: function (t) { B(t), S(r) }, error: function () { } }) } function B(t) { t = '<div class="miniProductDetailsPanelAjaxBusy"></div><div class="clear"></div>' + t; var r = a(".miniProductDetailsView").data("kendoWindow").content(t); r.center(), r.open() } function S(t) { var r = a.getAttrValFromDom(".miniProductDetailsView .miniProductDetailsViewAddToCartButton", "data-productId", 0); if (r > 0) { var o = ".miniProductDetailsView #addtocart_" + r + "_EnteredQuantity"; a(o).length > 0 && a(o).val(t) } } function W() { return a.getHiddenValFromDom("#getMiniProductDetailsViewUrl") } function k(t) { var r = 1, o = a.getAttrValFromDom(t, "data-productId"); if ("" != o) { var e = "#productQuantity" + o; if (a(e).length > 0) { var n = a(e).val(); n > 0 && (r = n) } } return r } function E() { return a.getHiddenValFromDom("#addProductToCartUrl") } function I() { return a.getHiddenValFromDom("#checkProductAttributesUrl") } function q(t, r) { var o = a(t).filter("div[data-productId='" + r.productId + "']"); if (o && o.length > 0) { var e = a.getAttrValFromDom(o, "data-isProductPage"); e && e == r.isProductPage.toString() && a(r.buttonElement).replaceWith(o[0]) } } function H() { return a.getAttrValFromDom(U, "data-getAjaxCartButtonUrl") } function R() { var t = Q(), r = a(t); if (r.length > 0) { var o = r.height(), e = r.width(); a(".nopAjaxCartPanelAjaxBusy").height(o), a(".nopAjaxCartPanelAjaxBusy").width(e), a(".nopAjaxCartPanelAjaxBusy").show() } } function O() { a(".nopAjaxCartPanelAjaxBusy").hide() } function Q() { var t = "body"; return t } function $() { return a.getHiddenValFromDom("#enableOnMobileDevices") } t.waitForAjaxRequest = !1, t.replaceAddToCartButtonsExternal = function () { o() }; var U = ".ajaxCartInfo"; t.closeProductAddedToCartWindow = function () { var t = a(".productAddedToCartWindow").data("kendoWindow"); t && t.close() }; var M = a.getSpikesViewPort(), z = $(); (!a.isMobile() && M.width > 980 || a.isMobile() && "true" == z) && (o(), d(), u(), a("body").on("click", ".nopAjaxCartProductListAddToCartButton", function (t) { e(t) }), a("body").on("click", ".nopAjaxCartProductVariantAddToCartButton", function (t) { var r = !1; a(this).hasClass("miniProductDetailsViewAddToCartButton") && (r = !0), i(t, r) }), a(document).on("nopAjaxFiltersFiltrationCompleteEvent", o), a(document).on("nopQuickViewDataShownEvent", o)) }(window.nopAjaxCart = window.nopAjaxCart || {}, jQuery) });